---
layout: post
title: DDD
categories: [بیزینس, طراحی_سیستم, برنامه‌نویسی]
---

خلاصه مطلب یادگیری Domain Driven Design

---

ایده: سایت پرستاری از سالمندان و کودکان  
کتابها: Learning.Domain-Driven.Design و Domain-Driven Design Tackling Complexity in the Heart of Software و Wrox.Patterns.Principles.and.Practices.of.Domain-Driven.Design

---

### 2. این «درس» را چطور جلو ببریم؟ (۵ گام)

**گام ۱ – فهم دامنه و Core Domain روی ایده خودت**  
تحلیل بازار ایران، مدل درآمد، ذی‌نفع‌ها، سناریوهای کلیدی، و استخراج Core / Supporting / Generic Subdomains.  
این گام مستقیم به هدف «تحلیل دامنه و فکر کردن مثل معمار» کمک می‌کند.

**گام ۲ – Ubiquitous Language و Bounded Contextها**  
ساخت دیکشنری زبان مشترک، کشف چند Bounded Context (مثلاً Matching، Scheduling، Billing، Identity) و یک Context Map سطح بالا.

**گام ۳ – طراحی تاکتیکی داخل یک Bounded Context**  
روی مهم‌ترین Bounded Context (مثلاً Matching & Booking) تمرکز می‌کنیم:  
Entities, Value Objects, Aggregates, Domain Services, Domain Events، Ruleها و Invariantها.

**گام ۴ – معماری و پیاده‌سازی با .NET**  
انتخاب سبک معماری (Layered یا Ports & Adapters/Hexagonal)، الگوهای ماژول‌بندی، مرزبندی پروژه‌ها، تست‌پذیری، و pitfalls واقعی در پروژه‌های DDD روی .NET.

**گام ۵ – تکامل سیستم، نسخه‌گذاری مدل و سناریوهای سخت**  
Refactoring مدل دامنه، شکستن/ترکیب Bounded Context، رشد به microservices، Event‑Driven، و پاسخ به سوال‌های پیچیده (breaking changes در قراردادها، consistency، گزارش‌گیری و…).

### شروع عملی گام ۱: فهم دامنه ایده در ایران

الان فقط یک ایده خام داریم: «پرستار سالمند + پرستار کودک، on‑demand».  
برای DDD، اول باید بفهمیم:

1. ذی‌نفع‌ها کی هستند؟ (حداقل ۳ دسته)  
2. بزرگ‌ترین ریسک/درد برای هر کدام چیه؟ (ترس، دردسر، هزینه، زمان، اعتماد و …)  

در DDD (و کلاً تحلیل کسب‌وکار)، «ذی‌نفع» یعنی هر کسی که از سیستم *تأثیر می‌گیرد* یا روی سیستم *تأثیر می‌گذارد*؛ لزوماً کاربر مستقیم نیست.

مثال در ایده تو:  
- کسی که سفارش پرستار می‌دهد (خانواده سالمند/کودک)  
- خودِ پرستار  
- شرکت/استارتاپی که پلتفرم را می‌گرداند  
(بعداً می‌توانیم بیمه، نهادهای نظارتی و … را هم اضافه کنیم.)

برای ادامه گام ۱:  
به نظرت مهم‌ترین سه گروه ذی‌نفع در ایران برای این ایده چه کسانی هستند؟ فقط اسم نقش‌ها را بگو.

---

جوابت خوبه ولی برای DDD کمی ناقصه و همین‌جا فرصت یادگیری داریم.

تو گفتی:  
- خانواده فرد سالمند/کودک  
- پرستاران  
- سالمند یا کودک  

این‌ها درست‌اند، اما برای تحلیل دامنه و طراحی معماری، حداقل این ذی‌نفع‌های مهم دیگر هم داریم (اینجا فقط نام می‌برم، بعداً عمیق می‌شویم):

- خود پلتفرم/استارتاپ (مالک کسب‌وکار)  
- بیمه‌ها یا نهادهای حامی (در آینده)  
- نهادهای نظارتی/قانونی (مثلاً مجوزها، شکایات)

در گام ۱ از «lesson plan» ما، هدف این است که دامنه را شفاف کنیم تا بعداً Core Domain را پیدا کنیم و Bounded Contextها را اشتباه تعریف نکنیم.

حالا یک قدم جلوتر:  
به نظرت *مهم‌ترین مشکل/درد خانواده‌ها* در ایران برای گرفتن پرستار چیه؟ فقط ۱ مورد که به نظرت از همه حیاتی‌تره بگو.

---

جوابی که دادی («عدم اطمینان به افراد و پیدا نکردن پرستار مطمئن و قابل ردیابی») کاملاً منطقی و مهم است، ولی دقت کنیم:  
این فقط *یکی* از چند درد مهم خانواده‌هاست، نه لزوماً تنها یا حتماً اصلی‌ترین.

در گام ۱ از lesson plan ما، هدف‌مان این است که *دردهای کلیدی* را شناسایی کنیم تا بعداً Core Domain را درست انتخاب کنیم (همان‌جایی که باید بیشترین سرمایه‌گذاری طراحی DDD را انجام بدهیم).

تا اینجا می‌دانیم:  
- یک مشکل حیاتی: **اعتماد** و ردیابی پرستار در خانه.  
الان برای عمق بیشتر، می‌خواهم خودت مقایسه کنی:

به نظرت برای خانواده‌ها در ایران، کدام مهم‌تر است:  
اعتماد و امنیت پرستار، یا قیمت و توان پرداخت هزینه پرستار؟ فقط یکی را انتخاب کن و بگو چرا.

---

برداشتت درسته و با رفتار واقعی خیلی از خانواده‌ها هم‌خوان است: وقتی پای سالمند/کودک وسط است، *اعتماد* معمولاً از قیمت مهم‌تر می‌شود، مخصوصاً در خدمات خانگی حساس.[5][7]

تا اینجای گام ۱ از lesson plan:  
- ذی‌نفع‌ها را شناسایی کردیم.  
- فهمیدیم «اعتماد و امنیت» برای خانواده‌ها احتمالاً کاندید Core Domain است (جایی که باید عمیق‌ترین DDD را رویش انجام دهیم).

یک قدم جلوتر برای تحلیل دامنه:  
به نظرت *چه چیزهایی* می‌تواند «اعتماد به پرستار» را در پلتفرم تو قابل‌سنجش یا قابل‌نمایش کند؟ ۲–۳ مورد مثل «سابقه تأییدشده، امتیاز کاربران، مدارک رسمی، ردیابی لوکیشن…» نام ببر.

---

مواردی که گفتی (سابقه تأییدشده در سایت، امتیاز دیگران، مدارک) کاملاً در راستای حل مسئله اعتماد هستند و خوب فکر کردی، فقط کمی آن‌ها را دقیق‌تر دامنه‌ای کنیم:

- **سابقه تأییدشده**: تعداد مأموریت‌های انجام‌شده، نوع مأموریت (سالمند/کودک)، بدون شکایت جدی.  
- **امتیاز و نظرها**: میانگین امتیاز، کامنت‌ها، گزارش تخلف.  
- **مدارک رسمی**: گواهی صلاحیت حرفه‌ای، نظام پرستاری، گواهی عدم سوءپیشینه، دوره‌های آموزشی.

این‌ها بعداً مستقیم تبدیل می‌شوند به Value Objectها، Policyها و شاید Aggregates در Core Domain «اعتماد و اعتبارسنجی».

در گام ۱ از lesson plan، الان داریم «محور Core Domain = اعتماد» را روشن می‌کنیم.

برای قدم بعد، می‌خواهم روی *سناریوهای اصلی* فکر کنیم:  
خانواده‌ای که می‌خواهد پرستار بگیرد، از لحظه‌ای که مشکل را حس می‌کند تا لحظه‌ای که پرستار را استخدام می‌کند، به نظرت ۳ مرحله اصلی مسیرش چیه؟ فقط به صورت خیلی کلی و مرحله‌مرحله بنویس.

---

مسیر کاربر را خوب توصیف کردی و با شواهد بازار ایران هم هم‌خوان است (جستجو در گوگل/شبکه اجتماعی، بعد تحقیق، بعد تماس و هماهنگی).[16][19]

در گام ۱ از lesson plan، الان داریم «journey فعلی» را می‌بینیم تا بعداً طراحی کنیم پلتفرم تو این مسیر را چطور کوتاه و امن‌تر می‌کند.

به‌صورت خیلی خلاصه:  
1. آگاهی از نیاز → جستجو (گوگل/اینستاگرام/پرسش از آشناها).  
2. غربال و تحقیق دستی → نگاه به سابقه، حرف دیگران، شاید تماس اولیه.  
3. توافق و هماهنگی → تماس، تعیین زمان، هزینه، شروع همکاری.

قدم بعدی برای مدل‌سازی دامنه:  
اگر پلتفرم *ایده‌آل* خودت را تصور کنی، دوست داری این ۳ مرحله برای خانواده *چطور* تغییر کند یا ساده‌تر شود؟ یک تغییر مهم که به ذهنت می‌رسد را بگو.

---

خیلی خوب مسیر ایده‌آلت را توصیف کردی؛ داری کم‌کم به «چشم‌انداز دامنه» نزدیک می‌شوی:

- تحقیق در خود سایت → لیست پرستارها + فیلترها + پروفایل اعتماد  
- پیدا کردن خودکار پرستار مناسب → Matching بر اساس نیاز خانواده  
- هماهنگی و زمان‌بندی خودکار → تقویم و اسلات‌های خالی پرستار  
- قرارداد و هزینه شفاف و آنلاین → کاهش ابهام و درگیری تلفنی

در گام ۱ از lesson plan، این‌ها کمک می‌کند بفهمیم کدام بخش‌ها احتمالاً Core Domain و کدام‌ها Supporting هستند (مثلاً Matching و Trust احتمالاً Core، پرداخت بیشتر Generic/Supporting).

حالا برای تکمیل تصویر بازار ایران (و ربط به DDD استراتژیک):  
به نظرت با وجود سرویس‌هایی مثل «اسنپ پرستار، اسنپ دکتر، آسانیسم و …» مزیت خاص پلتفرم تو نسبت به آن‌ها *چی می‌تواند باشد*؟ یک مزیت جدی که دوست داری روی آن متمرکز شوی را بگو.[1][2][7]

---

نکته‌ات درباره اسنپ‌دکتر خوب است ولی کافی نیست؛ الان مزیت تو فقط «داشتن پرستار ثابت» است، که به‌تنهایی سخت می‌تواند مزیت پایدار باشد مگر عمیق‌ترش کنیم.

ما تا اینجا از lesson plan:  
- گام ۱ را داریم جلو می‌بریم: فهم دامنه و کشف Core Domain.  
- رسیدیم به اینکه «اعتماد» + «رابطه بلندمدت با پرستار» ممکن است Core باشد.

برای بهتر کردن ایده، چند لایه روی حرفت اضافه می‌کنم (پیشنهادی):

1. پرستار ثابت *با مدیریت حرفه‌ای رابطه*:  
   - برنامه مراقبت (Care Plan) شخصی‌سازی‌شده برای هر سالمند/کودک.  
   - پیگیری طولانی‌مدت وضعیت سلامت، نه فقط حضور فیزیکی.  
2. شفافیت و امنیت برای خانواده:  
   - گزارش روزانه/هفتگی از وضعیت سالمند (دارو، حال عمومی، اتفاقات خاص).  
   - امکان نظارت نرم (نه جاسوسی): مثلاً چک‌این/چک‌اوت، لاگ فعالیت‌ها.  
3. جذابیت برای خود پرستار:  
   - قراردادهای شفاف، درآمد قابل پیش‌بینی، عدم استثمار مثل بعضی مراکز.  
   - امکان ساخت «برند شخصی» داخل پلتفرم (مسیر رشد پرستار).

اگر این‌ها را بپذیریم، می‌توانیم بگوییم Core Domain تو چیزی شبیه این است:

> طراحی و مدیریت «رابطه امن و پایدار» بین خانواده و پرستار، با تمرکز بر اعتماد، تداوم مراقبت و شفافیت برای هر دو طرف.

این تعریف بعداً روی همه تصمیم‌های DDD تو اثر دارد:  
- چه Bounded Contextهایی بسازی.  
- کجا بیشترین وقت مدل‌سازی دامنه را بگذاری.  
- چه چیزهایی فقط Generic/Supporting باشند (مثل پرداخت آنلاین، احراز هویت پایه).

سوال برای چک‌کردن فهمت و ادامه گام ۱:  
اگر بپذیریم Core Domain تو «رابطه امن و پایدار خانواده–پرستار» است، به نظرت *کدام یک از این سه* باید عمیق‌ترین طراحی دامنه را بگیرد؟  
۱) Matching اولیه (پیدا کردن پرستار مناسب)  
۲) مدیریت قرارداد و مالی  
۳) پیگیری و گزارش‌دهی مداوم وضعیت سالمند/کودک  

فقط یکی را انتخاب کن و دلیل کوتاه بگو.

---

از بین سه گزینه‌ای که خودم پیشنهاد دادم، **انتخاب تو («پیدا کردن پرستار مناسب») هم‌راستاست با Core Domain اعتماد**؛ ولی باید آن را بسیار قوی‌تر و عمیق‌تر از رقبا طراحی کنی:

### چند مزیت رقابتی که *می‌توانی* بسازی (فراتر از رقبا)

۱. **Matching هوشمند و عمیق، نه فقط جستجوی لیست**  
   به‌جای اینکه فقط خانواده لیست پرستارها را ببیند (مثل اغلب سایت‌ها)، تو می‌توانی یک «موتور تطبیق» قوی بسازی که بر اساس:

   - نوع نیاز (سالمند/کودک، مشکلات خاص مثل آلزایمر، اوتیسم، ناتوانی حرکتی…)  
   - سطح مهارت پرستار (دوره‌ها، تجربه واقعی، تاییدیه‌های حرفه‌ای)  
   - ترجیحات نرم خانواده (جنسیت، سن، روحیه، زبان/لهجه، سیگاری نبودن و …)  
   - موقعیت مکانی و دسترسی  
   یک «رتبه‌بندی» و پیشنهاد هوشمند بدهد، نه فقط فهرست.

   این قسمت می‌تواند Core Domain تو شود: **طراحی مدل غنی از «نیاز مراقبتی» و «پروفایل پرستار» و الگوریتم تطبیق آن‌ها**. این چیزی است که رقبا معمولاً ساده گرفته‌اند و بیشتر به صورت call center و فرم ساده کار می‌کنند.[4][1]

۲. **مدیریت رابطه بلندمدت خانواده–پرستار**  
   امروز سرویس‌ها اغلب روی «اعزام» تمرکز دارند، نه روی *رابطه بلندمدت* و مراقبت مستمر. تو می‌توانی:[1][4]

   - Care Plan شخصی برای هر سالمند/کودک تعریف کنی.  
   - پیگیری وضعیت (گزارش‌های روزانه/هفتگی، هشدارها، وضعیت دارو).  
   - ریسک‌ها و تغییرات وضعیت را به خانواده نشان بدهی.  

   این یعنی **مدل دامنه‌ات فقط «سفارش و پرداخت» نیست، بلکه «مسیر مراقبت» است**.

۳. **شفافیت دوطرفه و عدالت برای پرستار**  
   اکثر پلتفرم‌ها روی مشتری‌مداری تمرکز تبلیغ می‌کنند، اما خود پرستار اغلب یک «نیروی مصرف‌شونده» است. اگر تو:[4][1]

   - مدل شفاف کمیسیون،  
   - مسیر رشد مهارتی و درآمدی،  
   - امکان ساخت «اعتبار و برند» شخصی در پلتفرم  

   تعریف کنی، برای خود پرستار هم جذاب می‌شوی؛ این در عمل، retention و کیفیت شبکه پرستارها را بالا می‌برد که مزیت رقابتی جدی است.

از دید DDD استراتژیک (چیزی که در Evans و Vernon زیاد رویش تاکید شده)، باید تصمیم بگیری:

- Core Domain تو دقیقاً کدام است؟  
  - فقط «Matching هوشمند»؟  
  - یا «Matching + Care Plan + Relationship Management»؟  

چون Core Domain همان‌جایی است که باید بیشترین انرژی مدل‌سازی، Refactoring و طراحی Domain Model غنی را بگذاری؛ بقیه (پرداخت، احراز هویت، پیام‌رسانی) می‌توانند Supporting/Generic باشند.

برای ادامه lesson plan و رفتن به سمت Bounded Context و Ubiquitous Language، باید این را قاطع‌تر مشخص کنیم.

سوال برای گام بعد:  
اگر مجبور باشی *فقط یکی* را Core انتخاب کنی، ترجیح می‌دهی DDD عمیق را روی **Matching هوشمند** بسازی، یا روی **مدیریت رابطه و Care Plan طولانی‌مدت**؟ و چرا؟

---

تحلیل‌ات جهتش درسته و این یک نکته مهمه، اما کمی ناقصه و می‌شه شفاف‌ترش کرد.

تو می‌گی:

> مدیریت رابطه و Care Plan طولانی‌مدت چیزی‌ه که هم پرستار رو نگه می‌داره، هم مشتری رو.

این دقیقاً دارد به قلب Core Domain اشاره می‌کند، ولی اگر فقط «طولانی‌مدت بودن» را ببینی، رقبا هم می‌تونن بگن ما هم قراردادهای بلندمدت داریم. چیزی که باید قوی‌ترش کنی:

- *رابطه* = فقط «مدت زمان» نیست؛ شامل اعتماد، کیفیت تعامل، پیش‌بینی‌پذیری و شفافیت دوطرفه است.  
- *Care Plan* = یک مدل دامنه‌ست: هدف‌ها، ریسک‌ها، کارهای روزمره، شاخص‌های وضعیت، و بازخورد خانواده.

اگر این را Core بگیری، معماری DDD تو به این جهت می‌رود که:

- برای هر سالمند/کودک، یک Care Plan زنده و قابل‌تکامل مدل می‌کنی.  
- رفتار پرستار، گزارش‌ها و رضایت خانواده روی این Plan اثر می‌گذارند (Domain Events).  
- Matching اولیه هم باید با توجه به نوع Care Plan انجام شود، نه فقط «فاصله و قیمت».

پس پاسخ درست‌تر برای خودت این است:

> Core Domain من «طراحی و مدیریت رابطه مراقبتی بلندمدت بر اساس یک Care Plan زنده» است؛ Matching و قرارداد، در خدمت این هدف‌اند، نه هدف اصلی.

در lesson plan ما، این یعنی گام ۱ (فهم دامنه و Core Domain) تقریباً تکمیل شده و از گام بعدی می‌تونیم وارد **Ubiquitous Language و Bounded Contextها** بشیم، با محور «Care Plan & Relationship Management» به‌عنوان Core.

حالا برای چک‌کردن فهمت و رفتن به گام ۲:  
اگر «Care Plan و رابطه بلندمدت» Core باشد، چه *یک واژه یا مفهوم کلیدی* (مثل «پرونده مراقبتی»، «برنامه مراقبت»، «پرونده خانوادگی» و …) دوست داری به‌عنوان کلمه‌ی مرکزی در زبان دامنه‌ات استفاده کنی؟ یک اسم پیشنهادی بگو.

---